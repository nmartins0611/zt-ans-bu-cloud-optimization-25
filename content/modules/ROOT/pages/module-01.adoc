:doctype: book
:toc:
:toc-title: Table of Contents
:sectnums:
:icons: font

= Lab Guide: Cloud Optimization with Dynamic Inventory
_A guide to understanding basic optimization exercises for public cloud environments._

*Estimated time to complete: 10 minutes*

---

== Lab Overview

Welcome to the `Ansible Hybrid Cloud Automation - Cloud Optimization` lab. In this guide, you will learn about a pre-configured Dynamic Inventory and how to use resource tags to manage and report on your cloud infrastructure.

---

== Task 1: Log into Ansible Automation Platform

First, you will log in to the automation controller to begin the lab exercises.

. **Navigate to the Automation Controller UI.**
+
Click on the **Automation Controller** tab at the top of your lab window.

. **Log in with the provided credentials.**
+
[cols="1,2a"]
|===
| Parameter | Value
| Username | `admin`
| Password | `ansible123!`
|===

After logging in, you will land on the main dashboard.

---

== Task 2: Examine the Dynamic Inventory

In this task, you will explore the pre-configured dynamic inventory and inspect the host variables and tags that are automatically discovered from AWS.

. **Navigate to the Inventories menu.**
+
In the left navigation menu, go to *Infrastructure* â†’ *Inventories*.

. **Select the AWS Inventory.**
+
Click on the inventory named `AWS Inventory`.
+
image::https://github.com/IPvSean/pictures_for_github/blob/master/aws_inventory.png?raw=true[AWS Inventory details page, 250, opts="border"]

. **View the hosts.**
+
Click on the **Hosts** tab. You will see two hosts listed, identified by their `Name` tag from AWS EC2.

. **Inspect a host's variables.**
+
Click on one of the hosts to open its details page.

. **Examine the tags.**
+
On the host's *Details* tab, scroll down to the `VARIABLES` section. Note the `tags` section, which contains key-value pairs discovered directly from the EC2 instance. We will use these tags in a later step.
+
image::https://github.com/IPvSean/pictures_for_github/blob/master/tags.png?raw=true[EC2 instance tags in automation controller, 500, opts="border"]

TIP: To see these same tags in the AWS console, you can open the *AWS console* tab in your lab environment, log in, and navigate to the EC2 service to inspect the instances.

---

== Task 3: Create a Job Template

Next, you will create a job template to run a playbook that retrieves and displays tag information from your AWS resources.

. **Navigate to the Templates page.**
+
From the left navigation menu, select *Templates*.

. **Initiate the creation of a new job template.**
+
Click the **Create template** button, then select **Create job template**.
+
image::https://github.com/HichamMourad/awsoptimize25/blob/master/images/create_templates.png?raw=true[Create a new job template, 600, opts="border"]

. **Enter the job template details.**
+
Fill out the form with the following information:
+
[cols="1,1"]
|===
| Parameter | Value
| Name | `Retrieve tag information`
| Job Type | `Run`
| Inventory | `Demo Inventory`
| Project | `AWS Demos Project`
| Execution Environment | `AWS Execution Environment`
| Playbook | `playbooks/tag_info_aws.yml`
| Credentials | `AWS_Credential`
|===
+
NOTE: To find the `AWS_Credential`, you may need to filter the *Credential Type* to `Amazon Web Services`.

. **Save the job template.**
+
Scroll to the bottom and click the blue **Save** button.

NOTE: The Ansible Playbooks for this lab are sourced from the following project: link:https://github.com/ansible-cloud/aws_demos[ansible-cloud/aws_demos].

---

== Task 4: Launch the Job Template and Review Output

Finally, you will run the job template and examine the structured data it collects.

. **Launch the job template.**
+
Navigate back to the *Templates* page, find the `Retrieve tag information` job template, and click the **Launch** icon (ðŸš€).
+
image::https://github.com/IPvSean/pictures_for_github/blob/master/launch_job.png?raw=true[Launch Job Icon, 80, opts="border"]

. **Understand the playbook execution.**
+
This playbook runs four tasks to gather and display information:
+
* It uses the `amazon.aws.ec2_vpc_net_info` module to get data for all VPCs.
* It uses the `debug` module to print the VPC ID, name, and tags.
* It uses the `amazon.aws.ec2_instance_info` module to get data for all EC2 instances.
* It uses another `debug` task to print the EC2 instance name, ID, and tags.

. **Review the job output.**
+
The final task in the playbook uses a loop to display the information for each instance.
+
[source,yaml]
----
- name: Display AWS EC2 info and tags information to terminal
  debug:
    msg:
      - "{{ item.tags['Name'] | default('The tag *Name* Does not exist') }}"
      - "{{ item.instance_id }}"
      - "{{ item.tags }}"
  loop: "{{ ec2_instance_info.instances }}"
----
+
The output in the automation controller will show this structured data clearly for each resource
